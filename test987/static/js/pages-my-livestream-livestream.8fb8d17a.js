(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-my-livestream-livestream"],{"3cf8":function(e,t,n){var r=n("24fb");t=r(!1),t.push([e.i,'@charset "UTF-8";\r\n/**\r\n * 这里是uni-app内置的常用样式变量\r\n *\r\n * uni-app 官方扩展插件及插件市场（https://ext.dcloud.net.cn）上很多三方插件均使用了这些样式变量\r\n * 如果你是插件开发者，建议你使用scss预处理，并在插件代码中直接使用这些变量（无需 import 这个文件），方便用户通过搭积木的方式开发整体风格一致的App\r\n *\r\n */\r\n/**\r\n * 如果你是App开发者（插件使用者），你可以通过修改这些变量来定制自己的插件主题，实现自定义主题功能\r\n *\r\n * 如果你的项目同样使用了scss预处理，你也可以直接在你的 scss 代码中使用如下变量，同时无需 import 这个文件\r\n */\r\n/* 颜色变量 */\r\n/* 行为相关颜色 */\r\n/* 文字基本颜色 */\r\n/* 背景颜色 */\r\n/* 边框颜色 */\r\n/* 尺寸变量 */\r\n/* 文字尺寸 */\r\n/* 图片尺寸 */\r\n/* Border Radius */\r\n/* 水平间距 */\r\n/* 垂直间距 */\r\n/* 透明度 */\r\n/* 文章场景相关 */.clearfix[data-v-c3f5ee40]{zoom:1}.clearfix[data-v-c3f5ee40]:after{content:"";clear:both;height:0;line-height:0;display:block;visibility:hidden}.page_container[data-v-c3f5ee40]{padding:%?48?% %?35?%;line-height:1}.page_container .page_title[data-v-c3f5ee40]{color:#fff;margin-bottom:%?31?%;font-size:%?30?%}.page_container .balance[data-v-c3f5ee40]{font-size:%?40?%;color:#fff;margin-bottom:%?48?%}.page_container .duihuan_box[data-v-c3f5ee40]{padding:%?31?% %?25?% %?38?% %?25?%;background-color:#11161e}.page_container .duihuan_box .box_title[data-v-c3f5ee40]{font-size:%?30?%;color:#9aa8b5;margin-bottom:%?70?%}.page_container .duihuan_box .value_box[data-v-c3f5ee40]{display:flex;align-items:flex-end;padding-bottom:%?28?%;border-bottom:1px solid #222a3a;margin-bottom:%?35?%}.page_container .duihuan_box .value_box .value_label[data-v-c3f5ee40]{font-size:%?24?%;color:#9aa8b5;flex:0 0 auto;margin-right:%?30?%;width:%?50?%;vertical-align:bottom}.page_container .duihuan_box .value_box .uni-input[data-v-c3f5ee40]{color:#f9cd7c;font-size:%?60?%}.page_container .duihuan_box .tootip[data-v-c3f5ee40]{color:#4c5768;font-size:%?26?%}.page_container .btn[data-v-c3f5ee40]{width:%?580?%;height:%?88?%;line-height:%?80?%;box-sizing:border-box;text-align:center;background:#16202a;border:2px solid #f9cd7c;border-radius:%?44?%;color:#f9cd7c;position:fixed;bottom:%?20?%;left:0;right:0;margin-left:auto;margin-right:auto;z-index:999}.page_container .btnpk[data-v-c3f5ee40]{width:%?80?%;height:%?80?%;line-height:%?75?%;box-sizing:border-box;text-align:center;background:#16202a;border:2px solid #f9cd7c;border-radius:%?40?%;color:#f9cd7c;position:fixed;top:%?5?%;right:%?5?%;margin-left:auto;margin-right:auto;z-index:999}.page_container .btnpkend[data-v-c3f5ee40]{width:%?160?%;height:%?80?%;line-height:%?70?%;box-sizing:border-box;text-align:center;background:#16202a;border:2px solid #f9cd7c;border-radius:%?40?%;color:#f9cd7c;position:fixed;top:%?5?%;right:%?5?%;margin-left:auto;margin-right:auto;z-index:999}.page_container .value_[data-v-c3f5ee40]{background-color:#131b24;width:100%;height:%?495?%;border-radius:%?10?%;box-sizing:border-box;padding:%?42?% %?35?%;font-size:%?30?%;color:#fff;padding-bottom:%?80?%}',""]),e.exports=t},4456:function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return i})),n.d(t,"a",(function(){}));var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("layout",{attrs:{hasTabbar:!1}},[n("v-navbar",{attrs:{title:"开播",backCB:e.close}}),n("v-uni-view",{staticClass:"page_container",staticStyle:{padding:"0px"}},[e.isPlaying?e._e():n("v-uni-textarea",{staticClass:"value_",attrs:{maxlength:300,cols:"300",rows:"10"},model:{value:e.webrtcUrl,callback:function(t){e.webrtcUrl=t},expression:"webrtcUrl"}}),n("v-uni-view",{staticClass:"btn btn_active",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.submit.apply(void 0,arguments)}}},[e._v(e._s(e.labelBtn))])],1)],1)},i=[]},6701:function(e,t,n){"use strict";n.r(t);var r=n("4456"),i=n("ea2e");for(var a in i)["default"].indexOf(a)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(a);n("a01f");var o=n("f0c5"),s=Object(o["a"])(i["default"],r["b"],r["c"],!1,null,"c3f5ee40",null,!1,r["a"],void 0);t["default"]=s.exports},a01f:function(e,t,n){"use strict";var r=n("fea0"),i=n.n(r);i.a},b2d8:function(e,t,n){"use strict";n("7a82");var r=n("4ea4").default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,n("d3b7"),n("3ca3"),n("ddb0"),n("e9c4"),n("4de4");var i=r(n("5530")),a=r(n("c7eb")),o=r(n("1da1")),s=n("4b93"),c=n("26cb"),l={data:function(){return{isPlaying:!1,isPKing:!1,labelBtn:"开播",livePusher:null,mediaStream:null,arsdkStream:null,imgPath:"../../../static/image/chat/14.jpeg",arsdk:null,filterChoose:0,webrtcUrl:"webrtc://193740.push.tlivecloud.com/live/test987?txSecret=c1d4c096f8965d1827f0561e283038c9&txTime=6773A345",beautify:{whiten:0,dermabrasion:0,lift:0,shave:0,eye:0,chin:0},showPickerPK:!1,loadingPickerPK:!1,columnsPickerPK:[[]],showPickerAgree:!1,loadingPickerAgree:!1,columnsPickerAgree:[["接受PK","拒绝PK"]],titlePickerAgree:"是否同意PK",websocket:null,heartbeatInterval:null,fromUserName:"",fromUserId:"",myLoginNumber:0,pkTimer:null,waitingPk:!1}},computed:{},onLoad:function(){return(0,o.default)((0,a.default)().mark((function e(){return(0,a.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()},created:function(){this.getScript()},methods:(0,i.default)((0,i.default)({},(0,c.mapActions)(["logoutAction"])),{},{getScript:function(){var e=document.createElement("script");e.type="text/javascript",e.src="static/script/TXLivePusher-2.0.5.min.js",document.getElementsByTagName("head")[0].appendChild(e)},close:function(){this.switchBtn(!1)},switchBtn:function(e){if(e)this.isPlaying=!0,this.labelBtn="下播";else if(this.labelBtn="开播",this.disconnectWebSocket(),this.isPlaying){var t;if(this.isPlaying=!1,s.API.broadcastClose(),this.livePusher)this.livePusher.stopPush(),this.livePusher.destroy(),this.livePusher=null,null===(t=this.arsdk)||void 0===t||t.destroy();var n=document.getElementById("id_local_video");n&&n.parentNode.removeChild(n)}},chooseAvatar:function(){this.$u.route({url:"/uni_modules/uview-ui/components/u-avatar-cropper/u-avatar-cropper",params:{destWidth:500,rectWidth:300,fileType:"jpg"}})},submit:function(){var e=this;return(0,o.default)((0,a.default)().mark((function t(){var n;return(0,a.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.isPlaying){t.next=3;break}return e.switchBtn(!1),t.abrupt("return");case 3:e.switchBtn(!0),n=document.createElement("div"),n.id="id_local_video",n.style="width:100%;",document.getElementsByClassName("page_container")[0].appendChild(n),e.livePusher=new TXLivePusher,e.livePusher.setRenderView("id_local_video"),document.getElementById("id_local_video").getElementsByTagName("video")[0].muted=!0,!1,e.livePusher.setVideoQuality("720p"),e.livePusher.setAudioQuality("standard"),e.livePusher.setProperty("setVideoFPS",25),e.livePusher.startCamera(),e.livePusher.startMicrophone(),Promise.all([e.livePusher.startCamera(),e.livePusher.startMicrophone()]).then((function(){console.log("采集完摄像头和麦克风之后自动推流"),console.log(e.webrtcUrl),e.livePusher.startPush(e.webrtcUrl),e.createWS()})),e.livePusher.setObserver({onWarning:function(e,t){console.log("onWarning"),console.log(e,t)},onPushStatusUpdate:function(t,n){console.log("onPushStatusUpdate"),console.log(t,n),"Disconnected"==n||"disconnected"==n?(e.$toast("Disconnected"),e.switchBtn(!1)):"connected"==n?e.$toast("开始推播"):"connecting"==n||(e.$toast("推播异常:"+n),e.getAnchor(),e.switchBtn(!1))},onStatisticsUpdate:function(e){}});case 14:case"end":return t.stop()}}),t)})))()},confirmPickerPK:function(e){var t=this;return(0,o.default)((0,a.default)().mark((function n(){return(0,a.default)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:console.log("confirm",e),t["showPickerPK"]=!1,t.fromUserId=""+e.value[0].loginNumber,t.fromUserName=e.value[0].nickName,t.websocket.send(JSON.stringify({code:1e3,message:t.fromUserId})),t.$toast("向 ".concat(t.fromUserName," 发起PK，等待60秒")),t.waitingPk=!0,t.pkTimer=setTimeout((function(){t.$toast("".concat(t.fromUserName," 无回应PK请求")),t.waitingPk=!1}),6e4);case 8:case"end":return n.stop()}}),n)})))()},cancelPickerPK:function(){this["showPickerPK"]=!1},clickPK:function(){var e=this;return(0,o.default)((0,a.default)().mark((function t(){var n,r,i;return(0,a.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.loadingPickerPK=!0,t.next=3,s.API.broadcastList();case 3:if(r=t.sent,console.log(r),0==(null===r||void 0===r||null===(n=r.data)||void 0===n?void 0:n.code)){t.next=9;break}return e["showPickerPK"]=!1,e.$toast("获取主播列表失败"),t.abrupt("return");case 9:return i=r.data.data.records.filter((function(t){return t.loginNumber!=e.myLoginNumber})),e.$refs.uPickerPK.setColumnValues(0,i),console.log(e.columnsPickerPK),t.next=14,e.$nextTick();case 14:e.loadingPickerPK=!1,e["showPickerPK"]=!0;case 16:case"end":return t.stop()}}),t)})))()},confirmPickerAgree:function(e){var t=this;return(0,o.default)((0,a.default)().mark((function n(){return(0,a.default)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(console.log("confirm",e),t["showPickerAgree"]=!1,"接受PK"==e.value[0]){n.next=5;break}return t.cancelPickerAgree(),n.abrupt("return");case 5:t.websocket.send(JSON.stringify({code:1002,message:t.fromUserId})),t.$toast("接受PK"),t.isPKing=!0;case 8:case"end":return n.stop()}}),n)})))()},cancelPickerAgree:function(){this["showPickerAgree"]=!1,this.websocket.send(JSON.stringify({code:1003,message:this.fromUserId}))},askAgree:function(){var e=this;return(0,o.default)((0,a.default)().mark((function t(){return(0,a.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.titlePickerAgree=e.fromUserName+" 发起PK",t.next=3,e.$nextTick();case 3:e["showPickerAgree"]=!0;case 4:case"end":return t.stop()}}),t)})))()},createWS:function(){},handleMessage:function(e){if("heartbeat"!=e.data){console.log(e.data);var t=JSON.parse(e.data);1===t.code&&1e3===t.codeType&&t.data?this.handlePKRequest(t):1===t.code&&1002===t.codeType&&t.data?this.handlePkAgree(t):1===t.code&&1003===t.codeType&&t.data?this.handlePkDeny(t):1===t.code&&1004===t.codeType&&t.data?this.handlePkFinish(t):1===t.code&&1006===t.codeType?this.handlePkStatus(t):this.handleOtherMessage(t)}},handlePKRequest:function(e){var t=e.data,n=t.fromUserName,r=t.fromUserId,i=t.fromUserPicture;console.log("收到 PK 请求:",n,r,i),this.fromUserName=n,this.fromUserId=r,this.askAgree()},handlePkAgree:function(e){var t=e.data,n=t.fromUserName,r=t.fromUserId,i=t.fromUserPicture;console.log("handlePkAgree:",n,r,i),this.fromUserName=n,this.fromUserId=r,this.$toast(this.fromUserName+" 已接受，PK开始"),this.isPKing=!0,this.waitingPk=!1,clearTimeout(this.pkTimer)},handlePkFinish:function(e){this.$toast("PK结束"),this.isPKing=!0},handlePkStatus:function(e){this.isPKing=1==e.data},handlePkDeny:function(e){var t=e.data,n=t.fromUserName,r=t.fromUserId,i=t.fromUserPicture;console.log("handlePkDeny:",n,r,i),this.fromUserName=n,this.fromUserId=r,this.$toast(this.fromUserName+" 已拒绝PK"),this.isPKing=!1,this.waitingPk=!1,clearTimeout(this.pkTimer)},handleOtherMessage:function(e){console.log("收到其他消息:",e.msg),e.msg&&this.$toast(e.msg)},disconnectWebSocket:function(){this.websocket&&(this.websocket.onopen=null,this.websocket.onmessage=null,this.websocket.onerror=null,this.websocket.onclose=null,clearInterval(this.heartbeatInterval),this.websocket.close(),this.websocket=null)},handleError:function(e){console.error("WebSocket连接发生错误:",e),this.disconnectWebSocket()},handleClose:function(e){console.log("WebSocket连接已关闭:",e),this.disconnectWebSocket(),this.reConnect()},handleOpen:function(){var e=this;console.log("WebSocket连接已打开"),this.heartbeatInterval=setInterval((function(){e.websocket.send("heartbeat"),e.getPkStatus()}),5e3)},getPkStatus:function(){this.websocket.send(JSON.stringify({code:1006,message:""}))},reConnect:function(){this.isPlaying&&this.createWS()},clickPKend:function(){var e=this;return(0,o.default)((0,a.default)().mark((function t(){return(0,a.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:console.log("clickPKend"),e.$toast("退出PK"),e.isPKing=!1,e.websocket.send(JSON.stringify({code:1005,message:""}));case 4:case"end":return t.stop()}}),t)})))()},getAnchor:function(){var e=this;return(0,o.default)((0,a.default)().mark((function t(){var n,r;return(0,a.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,s.API.anchorGet();case 2:if(r=t.sent,console.log("anchorRes",r),0===(null===r||void 0===r||null===(n=r.data)||void 0===n?void 0:n.code)){t.next=9;break}return e.$toast("TOKEN失效"),setTimeout((function(){e.logoutAction()}),1e3),e.switchBtn(!1),t.abrupt("return");case 9:return t.abrupt("return",r);case 10:case"end":return t.stop()}}),t)})))()}})};t.default=l},ea2e:function(e,t,n){"use strict";n.r(t);var r=n("b2d8"),i=n.n(r);for(var a in r)["default"].indexOf(a)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(a);t["default"]=i.a},fea0:function(e,t,n){var r=n("3cf8");r.__esModule&&(r=r.default),"string"===typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);var i=n("4f06").default;i("2b0d57d4",r,!0,{sourceMap:!1,shadowMode:!1})}}]);